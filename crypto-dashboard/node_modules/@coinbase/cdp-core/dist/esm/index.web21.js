import { createEndUserEvmSmartAccount as u } from "@coinbase/cdp-api-client";
import { Analytics as d } from "./index.web2.js";
import "./index.web3.js";
import { toAuthStateUser as A } from "./index.web43.js";
import { getCoreAuthManager as S, getConfig as f } from "./index.web49.js";
import { createEvmEoaAccount as h } from "./index.web20.js";
import { InternalError as p } from "./index.web32.js";
import { validateUserAuthState as g } from "./index.web53.js";
async function C(a) {
  d.sendActionCallEvent({ name: "create_evm_smart_account" });
  const e = S(), { user: r, authState: s } = g(
    e.getUser(),
    e.getAuthState()
  ), c = await (async () => r.evmAccountObjects?.[0]?.address ?? h())(), m = await u(
    f().projectId,
    r.userId,
    {
      owner: c,
      enableSpendPermissions: a?.enableSpendPermissions ?? !1
    }
  ), n = A(m);
  await e.setAuthState({
    ...s,
    user: n
  });
  const i = new Set(
    r.evmSmartAccountObjects?.map((t) => t.address) || []
  ), o = n.evmSmartAccountObjects?.find(
    (t) => !i.has(t.address)
  )?.address;
  if (!o)
    throw new p(
      "EVM Smart Account was not created. Check the network log for more details."
    );
  return o;
}
export {
  C as createEvmSmartAccount
};
