import { isAddress as n } from "viem";
import { getCurrentUserSync as h } from "./index.native14.js";
import { toTransactionSigner as s } from "./index.native50.js";
import { toViemAccount as c } from "./index.native32.js";
function g(e = {}) {
  const a = e.fetch ?? globalThis.fetch;
  let r = null;
  return { fetchWithPayment: async (...d) => {
    if (!r) {
      const t = h();
      if (!t)
        throw new Error("User not authenticated");
      const o = (() => {
        if (e.address && n(e.address))
          return c(e.address);
        if (e.address && !n(e.address))
          return s(e.address);
        if (t.evmSmartAccountObjects?.length)
          return c(t.evmSmartAccountObjects[0].address);
        if (t.evmAccountObjects?.length)
          return c(t.evmAccountObjects[0].address);
        if (t.solanaAccountObjects?.length)
          return s(t.solanaAccountObjects[0].address);
        throw new Error("No account found");
      })();
      try {
        const { wrapFetchWithPayment: u } = await import("x402-fetch");
        r = u(
          a,
          o,
          e.maxValue,
          e.paymentRequirementsSelector,
          e.config
        );
      } catch {
        throw new Error(
          "x402-fetch is not installed. Make sure x402-fetch is installed and try again."
        );
      }
    }
    return r(...d);
  } };
}
export {
  g as fetchWithX402
};
