const f = /* @__PURE__ */ new Map(), p = /* @__PURE__ */ new Map();
let w = 0;
function C(s, l, h) {
  const i = ++w, c = () => f.get(s) || [], g = () => {
    const n = c();
    f.set(s, n.filter((e) => e.id !== i));
  }, r = () => {
    const n = c();
    if (!n.some((t) => t.id === i))
      return;
    const e = p.get(s);
    if (n.length === 1 && e) {
      const t = e();
      t instanceof Promise && t.catch(() => {
      });
    }
    g();
  }, o = c();
  if (f.set(s, [
    ...o,
    { id: i, fns: l }
  ]), o && o.length > 0)
    return r;
  const u = {};
  for (const n in l)
    u[n] = (...e) => {
      const t = c();
      if (t.length !== 0)
        for (const m of t)
          m.fns[n]?.(...e);
    };
  const a = h(u);
  return typeof a == "function" && p.set(s, a), r;
}
export {
  p as cleanupCache,
  f as listenersCache,
  C as observe
};
