import { useEffect as f, useCallback as v } from "react";
const d = (n) => {
  const { pollFn: l, shouldStop: a, interval: r = 2e3, enabled: o, onSuccess: c, onError: i } = n;
  return { startPolling: v(async () => {
    if (!o) return;
    let t, s = !1;
    const u = async () => {
      try {
        const e = await l();
        if (s) return;
        a(e) && (c(e), t && clearInterval(t));
      } catch (e) {
        if (s) return;
        i(e instanceof Error ? e : new Error(String(e))), t && clearInterval(t);
      }
    };
    return await u(), t = setInterval(u, r), () => {
      s = !0, t && clearInterval(t);
    };
  }, [l, a, r, o, c, i]) };
}, I = (n, l) => {
  const { startPolling: a } = d(n);
  f(() => {
    if (!n.enabled) return;
    let r;
    return (async () => {
      r = await a();
    })(), () => {
      r && r();
    };
  }, l);
};
export {
  I as useAutoPolling,
  d as usePolling
};
