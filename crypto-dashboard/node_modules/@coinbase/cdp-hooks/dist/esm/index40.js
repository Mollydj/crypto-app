import { withResolvers as d } from "./index241.js";
const h = /* @__PURE__ */ new Map();
function S({ fn: p, id: o, shouldSplitBatch: a, wait: g = 0, sort: l }) {
  const u = async () => {
    const e = r();
    i();
    const s = e.map(({ args: t }) => t);
    s.length !== 0 && p(s).then((t) => {
      l && Array.isArray(t) && t.sort(l);
      for (let c = 0; c < e.length; c++) {
        const { resolve: n } = e[c];
        n?.([t[c], t]);
      }
    }).catch((t) => {
      for (let c = 0; c < e.length; c++) {
        const { reject: n } = e[c];
        n?.(t);
      }
    });
  }, i = () => h.delete(o), m = () => r().map(({ args: e }) => e), r = () => h.get(o) || [], f = (e) => h.set(o, [...r(), e]);
  return {
    flush: i,
    async schedule(e) {
      const { promise: s, resolve: t, reject: c } = d();
      return a?.([...m(), e]) && u(), r().length > 0 ? (f({ args: e, resolve: t, reject: c }), s) : (f({ args: e, resolve: t, reject: c }), setTimeout(u, g), s);
    }
  };
}
export {
  S as createBatchScheduler
};
