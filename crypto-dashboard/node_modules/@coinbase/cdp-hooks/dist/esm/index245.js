import { parseAvatarUri as o, parseNftUri as f, getNftTokenUri as v, resolveAvatarUri as l, getJsonImage as A, getMetadataAvatarUri as N } from "./index276.js";
async function b(r, { gatewayUrls: t, record: e }) {
  return /eip155:/i.test(e) ? U(r, { gatewayUrls: t, record: e }) : o({ uri: e, gatewayUrls: t });
}
async function U(r, { gatewayUrls: t, record: e }) {
  const i = f(e), s = await v(r, { nft: i }), { uri: a, isOnChain: c, isEncoded: p } = l({ uri: s, gatewayUrls: t });
  if (c && (a.includes("data:application/json;base64,") || a.startsWith("{"))) {
    const d = p ? (
      // if it is encoded, decode it
      atob(a.replace("data:application/json;base64,", ""))
    ) : (
      // if it isn't encoded assume it is a JSON string, but it could be anything (it will error if it is)
      a
    ), u = JSON.parse(d);
    return o({ uri: A(u), gatewayUrls: t });
  }
  let n = i.tokenID;
  return i.namespace === "erc1155" && (n = n.replace("0x", "").padStart(64, "0")), N({
    gatewayUrls: t,
    uri: a.replace(/(?:0x)?{id}/, n)
  });
}
export {
  b as parseAvatarRecord
};
